#+title: magit-gh
#+author: Jonathan Chu
#+email: me@jonathanchu.is

[[https://melpa.org/#/magit-gh][https://melpa.org/packages/magit-gh-badge.svg]]

~magit-gh~ is an Emacs package that integrates the [[https://cli.github.com][GitHub CLI]] (~gh~) into [[https://magit.vc/][Magit]]. It provides a Transient menu interface to list, checkout, and view pull requests directly from Emacs without leaving your workflow.

Features include:
  - List pull requests in a dedicated buffer with review status (toggle between open, closed, merged, and all)
  - PR status dashboard showing PRs you created, PRs awaiting your review, and recently merged PRs
  - View a PR diff in a dedicated buffer
  - Checkout a PR branch with a single keystroke
  - View a PR in the browser

* Why not Forge?

[[https://github.com/magit/forge][Forge]] is a fantastic and comprehensive package for interacting with Git forges from within Magit. If you need deep integration -- tracking issues, managing pull requests, reading and writing comments, all stored locally -- Forge is the right tool. *I would highly recommend Forge over this package if that is your use case*.

~magit-gh~ takes a different approach. It delegates to the [[https://cli.github.com][GitHub CLI]] (~gh~) for all GitHub interaction, which means:

- *No local database* -- Forge maintains a local SQLite database via ~emacsql~, which can be tricky to set up (compiling native modules, resolving binary availability issues). ~magit-gh~ stores nothing locally.
- *No token management* -- Forge requires a GitHub personal access token stored in your ~authinfo~ file (ideally encrypted with GPG). ~magit-gh~ piggybacks on ~gh auth login~, which you may have already configured.
- *Minimal dependencies* -- just Magit, Transient, and the ~gh~ CLI.

The trade-off is that ~magit-gh~ is far less featureful than Forge. It's intentionally a lightweight alternative for users who primarily want to list, checkout, and view pull requests without additional setup overhead.

** Requirements

  - Emacs 29.1+ (may work on older versions, this minimum version is what I've tested at least)
  - Magit 4.0.0+
  - Transient 0.5.0+
  - gh CLI ([[https://cli.github.com][installed separately]], must be authenticated via =gh auth login=)

** Installing gh CLI

*** macOS

#+begin_src sh
brew install gh
#+end_src

*** Linux (Fedora / RHEL / CentOS)

#+begin_src sh
sudo dnf install gh
#+end_src

For other operating systems, see the [[https://github.com/cli/cli#installation][official installation instructions]].

*** Authenticate

After installing, authenticate with your GitHub account:

#+begin_src sh
gh auth login
#+end_src

* Installation

Install from MELPA:

=M-x package-install RET magit-gh RET=

Or with ~use-package~:

#+begin_src emacs-lisp
(use-package magit-gh
  :ensure t
  :after magit)
#+end_src

* Usage

You can access ~magit-gh~ from the *Magit status menu* by typing ~,~ or ~m-x magit-gh~.

If you don't like the ~,~ key binding to invoke ~magit-gh~, you can set any custom value you want. Note that the variable must be set *before* the package loads:

#+begin_src emacs-lisp
(use-package magit-gh
  :ensure t
  :after magit
  :init
  (setq magit-gh-key ";")) ; Example setting key to ";" instead of the default ","
#+end_src

To increase the number of PRs fetched (default 30):

#+begin_src emacs-lisp
(use-package magit-gh
  :ensure t
  :after magit
  :custom
  (magit-gh-pr-limit 50))
#+end_src

The Transient menu is organized into Pull Request commands:

#+begin_example
magit-gh
└── Pull Requests
    ├── l  List PRs
    ├── s  PR status dashboard
    ├── c  Checkout PR
    ├── d  Diff PR
    └── v  View PR in browser
#+end_example

** PR List Buffer

When you list PRs (~l~), a dedicated buffer opens showing PR number, title, author, review status, and branch name. By default it shows open PRs, but you can toggle the state filter with ~t~ to cycle through open, closed, merged, and all. The following keybindings are available in this buffer:

| Key     | Action                            |
|---------+-----------------------------------|
| =RET=   | Checkout the PR at point          |
| =c=     | Checkout the PR at point          |
| =d=     | View the diff for the PR at point |
| =v=     | Open the PR at point in browser   |
| =t=     | Toggle state (open/closed/merged/all) |
| =g=     | Refresh the PR list               |
| =q=     | Close the buffer                  |

** PR Status Dashboard

The status dashboard (~s~) shows an overview of your PRs, mirroring =gh pr status=. It displays three sections: PRs you created, PRs awaiting your review, and recently merged PRs in the repository. The following keybindings are available in this buffer:

| Key     | Action                          |
|---------+---------------------------------|
| =RET=   | Checkout the PR at point        |
| =c=     | Checkout the PR at point        |
| =d=     | View the diff for the PR at point |
| =v=     | Open the PR at point in browser |
| =g=     | Refresh the status dashboard    |
| =q=     | Close the buffer                |

** Demo

[[https://raw.githubusercontent.com/jonathanchu/magit-gh/refs/heads/main/screenshots/20260214_magit_gh_demo.gif]]

** Customization

| Variable            | Default | Description                              |
|---------------------+---------+------------------------------------------|
| =magit-gh-key=      | =,=     | Key to bind ~magit-gh~ in Magit buffers  |
| =magit-gh-pr-limit= | =30=    | Maximum number of PRs to fetch           |

* Feature Status

  - [X] List pull requests (open, closed, merged, all)
  - [X] Checkout a pull request
  - [X] View a pull request in the browser
  - [X] View PR diff
  - [X] View PR checks/status
  - [ ] Create a new pull request
  - [ ] Merge a pull request
  - [ ] Review a pull request
  - [ ] List and manage issues

* Contributing

Contributions are welcome! If you'd like to help integrate additional ~gh~ CLI commands or improve existing functionality, please open a pull request.

Before submitting a PR, please keep in mind that this package is intended to extend Magit with useful GitHub CLI functionality -- not to duplicate what Magit already provides. If you're unsure whether a command is a good fit, feel free to open an issue to discuss it first.

To report bugs or request features, please use the [[https://github.com/jonathanchu/magit-gh/issues][GitHub issue tracker]].
